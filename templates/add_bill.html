{% extends "base.html" %}

{% block title %}Add Bill{% endblock %}

{% block content %}
<h1>Add Bill</h1>

<form method="post">
  <div class="mb-3">
    <label class="form-label">Customer:</label>
    <select class="form-select" name="customer_id" id="customer_id" required onchange="fillCustomerDetails()">
      <option value="" selected disabled>Select Customer</option>
      {% for customer in customers %}
        <option value="{{ customer[0] }}">{{ customer[1] }}</option>
      {% endfor %}
    </select>
  </div>

  <div id="customer-info" class="mb-3" style="display: none;">
    <div class="row">
      <div class="col-md-6"><strong>Phone:</strong> <span id="cust_phone"></span></div>
      <div class="col-md-6"><strong>Email:</strong> <span id="cust_email"></span></div>
    </div>
    <div class="row">
      <div class="col-md-6"><strong>Pet Name:</strong> <span id="cust_pet_name"></span></div>
      <div class="col-md-6"><strong>Pet Type:</strong> <span id="cust_pet_type"></span></div>
    </div>
    <div class="row">
      <div class="col-md-12"><strong>Notes:</strong> <span id="cust_notes"></span></div>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Service:</label>
    <input class="form-control" type="text" name="service" required>
  </div>

  <div class="mb-3">
    <label class="form-label">Amount:</label>
    <input class="form-control" type="number" step="0.01" name="amount" required>
  </div>

  <div class="mb-3">
    <label class="form-label">Date:</label>
    <input class="form-control" type="text" name="date" value="{{ current_date }}" disabled>
  </div>

  <div class="mb-3">
    <label class="form-label">Notes:</label>
    <textarea class="form-control" name="notes"></textarea>
  </div>

  <button type="submit" class="btn btn-primary">Add Bill</button>
</form>

<script>
  const customerDetails = {{ customer_details | tojson | safe }};

  function fillCustomerDetails() {
    const select = document.getElementById('customer_id');
    const infoDiv = document.getElementById('customer-info');
    const id = select.value;

    if (id && customerDetails[id]) {
      document.getElementById('cust_phone').textContent = customerDetails[id].phone || '';
      document.getElementById('cust_email').textContent = customerDetails[id].email || '';
      document.getElementById('cust_pet_name').textContent = customerDetails[id].pet_name || '';
      document.getElementById('cust_pet_type').textContent = customerDetails[id].pet_type || '';
      document.getElementById('cust_notes').textContent = customerDetails[id].notes || '';
      infoDiv.style.display = 'block';
    } else {
      infoDiv.style.display = 'none';
    }
  }
</script>
{% endblock %}
